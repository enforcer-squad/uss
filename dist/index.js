!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports["@enforcer-squad/uss"]=r():e["@enforcer-squad/uss"]=r()}(self,(()=>(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var a in t)e.o(t,a)&&!e.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:t[a]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};e.r(r),e.d(r,{devtools:()=>qe,effect:()=>ee,getData:()=>We,getDataStore:()=>Qe,getOrigin:()=>G,getReactiveData:()=>ze,invalidateData:()=>pr,setData:()=>Sr,subscribe:()=>he,toRaw:()=>Oe,useMutation:()=>qr,useQuery:()=>wr,useUSS:()=>we,uss:()=>ye});const t=require("@babel/runtime-corejs3/helpers/slicedToArray");var a=e.n(t);const n=require("react"),s=require("@babel/runtime-corejs3/core-js-stable/symbol");var o=e.n(s);const i=require("@babel/runtime-corejs3/core-js-stable/instance/slice");var l=e.n(i);const c=require("@babel/runtime-corejs3/core-js-stable/weak-map");var u=e.n(c);const v=require("@babel/runtime-corejs3/core-js-stable/reflect/get");var b=e.n(v);const d=require("@babel/runtime-corejs3/core-js-stable/reflect/set");var h=e.n(d);const p=require("@babel/runtime-corejs3/core-js-stable/reflect/own-keys");var f=e.n(p);const m=require("@babel/runtime-corejs3/core-js-stable/reflect/delete-property");var j=e.n(m);const g=require("@babel/runtime-corejs3/core-js-stable/reflect/apply");var y=e.n(g);const w=require("@babel/runtime-corejs3/core-js-stable/instance/for-each");var q=e.n(w);const O=require("@babel/runtime-corejs3/core-js-stable/instance/bind");var _=e.n(O);const S=require("@babel/runtime-corejs3/core-js-stable/instance/index-of");var x=e.n(S);const R=require("@babel/runtime-corejs3/core-js-stable/instance/splice");var k=e.n(R);const T=require("@babel/runtime-corejs3/core-js-stable/instance/filter");var N=e.n(T);const E=require("@babel/runtime-corejs3/core-js-stable/reflect/has");var P=e.n(E);const C=require("@babel/runtime-corejs3/core-js-stable/reflect/get-own-property-descriptor");var A=e.n(C),K=e=>"object"==typeof e&&null!==e,D=e=>"function"==typeof e,M=e=>"symbol"==typeof e;var $=(...e)=>{null!==localStorage.getItem("uss_debugger")&&console.log("uss info:",...e)},B=(e,...r)=>{var t,a={value:null};return t=a,function a(n){var s=e[n];s&&s(t,(()=>a(n+1)),...r)}(0),a},G=e=>null==e?void 0:e._NOTRACK_origin,F=o()("iteration key");function U(e){return e.charAt(0).toUpperCase()+l()(e).call(e,1)}const I=class{constructor(e,r){this.proxyTargetCache=new(u()),this.targetProxyCache=new(u()),this.middlewares=e,this.scopeName=r,this.handlers={get:[],set:[],ownKeys:[],delete:[],apply:[],init:[]},this.initHandler()}initHandler(){var e;this.handlers={get:[(e,r,t,a,n)=>{e.value=b()(t,a,n)}],set:[(e,r,t,a,n,s)=>{e.value=h()(t,a,n,s)}],ownKeys:[(e,r,t)=>{e.value=f()(t)}],delete:[(e,r,t,a)=>{e.value=j()(t,a)}],apply:[(e,r,t,a,n,s)=>{e.value=y()(t,s,n)}],init:[(e,r,t,a)=>{e.value=new Proxy(t,a)}]},q()(e=this.middlewares).call(e,(e=>{this.use(e)}))}updateMiddleware(e,r){var t=r[`on${U(e)}`];if(void 0!==t){var a=this.handlers[e].pop();this.handlers[e].push(_()(t).call(t,r)),this.handlers[e].push(a)}}use(e){var r;this.middlewares.push(e),q()(r=f()(this.handlers)).call(r,(r=>{var t=r;this.updateMiddleware(t,e)}))}unUse(e){var r,t,a,n=x()(r=this.middlewares).call(r,e);-1!==n&&(k()(t=this.middlewares).call(t,n,1),q()(a=f()(this.handlers)).call(a,(r=>{var t,a=r,n=`on${U(a)}`;this.handlers[a]=N()(t=this.handlers[a]).call(t,(r=>r!==e[n]))})))}proxyObject(e,r){if(!K(e)&&!D(e))throw new Error("init object must be Object");$("准备执行代理方法",this.scopeName,e);var t=this.handlers,a=this.proxyTargetCache,n=this.targetProxyCache;if(a.has(e))return $("缓存-直接返回",this.scopeName),e;var s=n.get(e);if(s)return $("缓存-返回缓存代理",this.scopeName),s;var o={get:(e,a,n)=>{if("_NOTRACK_origin"===a)return e;if("_NOTRACK_core"===a)return this;if(M(a)||0===x()(a).call(a,"_NOTRACK"))return b()(e,a,n);if(function(e,r){return P()(e,r)&&void 0===A()(e,r)}(e,a))return b()(e,a,n);if(e!==G(r)&&D(b()(e,a,n)))return b()(e,a,n);var s=B(t.get,e,a,n).value;return K(s)||D(s)?this.proxyObject(s,r):s},set:(e,r,a,n)=>M(r)?h()(e,r,a,n):e[r]===a||B(t.set,e,r,a,n).value,ownKeys:e=>B(t.ownKeys,e).value,deleteProperty:(e,r)=>B(t.delete,e,r).value,apply:(e,a,n)=>!!D(e)&&B(t.apply,e,a,n,r).value};$("执行代理方法",this.scopeName,e);var i=B(t.init,e,o).value;return n.set(e,i),a.set(i,e),void 0===r&&(r=i),i}},V=require("@babel/runtime-corejs3/helpers/defineProperty");var X=e.n(V);const H=require("@babel/runtime-corejs3/core-js-stable/map");var L=e.n(H);const Q=require("@babel/runtime-corejs3/core-js-stable/set");var W=e.n(Q),z={callback:null},J=new(u()),Y=new(L());var Z=e=>{var r=Y.get(e);r&&(q()(r).call(r,((r,t)=>{var a=J.get(t).get(r);null==a||a.delete(e)})),Y.delete(e))},ee=e=>{var r=()=>{Z(r),e()};z.callback=r,e(),z.callback=null};const re=class{constructor(){X()(this,"onGet",((e,r,t,a,n)=>{if(r(e,r,t,a,n),"function"!=typeof t[a]){var s=z.callback;if(s){var o=J.get(t)||new(L()),i=o.get(a)||new(W());i.add(s),o.set(a,i),J.set(t,o);var l=Y.get(s)||new(L());l.set(t,a),Y.set(s,l)}}})),X()(this,"onSet",((e,r,t,a,n,s)=>{var o=J.get(t);if(void 0!==o){if(!P()(t,a)){var i=o.get(F);i&&q()(i).call(i,(e=>e()))}var l=t[a];r(e,r,t,a,n,s);var c=o.get(a);c&&q()(c).call(c,(e=>e(n,l)))}else r(e,r,t,a,n,s)})),X()(this,"onOwnKeys",((e,r,t)=>{if(r(e,r,t),z.callback){var a=J.get(t)||new(L()),n=a.get(F)||new(W());n.add(z.callback),a.set(F,n),J.set(t,a)}})),X()(this,"onDelete",((e,r,t,a)=>{r(e,r,t,a);var n=J.get(t);if(void 0!==n){var s=n.get(a);s&&q()(s).call(s,(e=>e()))}}))}},te=require("@babel/runtime-corejs3/core-js-stable/array/from");var ae=e.n(te);const ne=require("@babel/runtime-corejs3/core-js-stable/instance/keys");var se=e.n(ne);const oe=require("@babel/runtime-corejs3/core-js-stable/instance/includes");var ie=e.n(oe),le=new(u()),ce=new(L()),ue="set",ve="delete",be="add",de=(e,r)=>{var t=le.get(e);return t?`${t}.${r}`:r};var he=(e,r)=>{var t=G(e),a=le.get(t);if(a){var n=ce.get(a)||new(W());return n.add(r),ce.set(a,n),()=>{var e=ce.get(a);e&&e.delete(r)}}return()=>{}};const pe=class{constructor(){X()(this,"onGet",((e,r,t,a,n)=>{r(e,r,t,a,n),K(e.value)&&(void 0===le.get(t)&&le.set(t,"root"),le.set(t[a],`${le.get(t)}.${a}`))})),X()(this,"onSet",((e,r,t,a,n,s)=>{var o=t[a],i=de(t,a);P()(t,a)||this.trigger(i,be,{value:n,prevValue:o}),r(e,r,t,a,n,s),this.trigger(i,ue,{value:n,prevValue:o})})),X()(this,"onDelete",((e,r,t,a)=>{r(e,r,t,a);var n=de(t,a);this.trigger(n,ve,{})})),X()(this,"onInit",((e,r,t,a)=>{r(e,r,t,a),t.key&&le.set(t,t.key)}))}trigger(e,r,t){var a,n=N()(a=ae()(se()(ce).call(ce))).call(a,(r=>ie()(e).call(e,r)));q()(n).call(n,(a=>{var n,s=e.replace(`${a}.`,"");null===(n=ce.get(a))||void 0===n||q()(n).call(n,(e=>e(s,r,t)))}))}};const fe=class{constructor(e){X()(this,"onGet",((e,r,t,a,n)=>{var s=this.dispatch;z.callback=s,r(e,r,t,a,n),z.callback=null})),X()(this,"onSet",((e,r,t)=>{throw new Error(`attempt to set property ${String(r)} to ${t}. This object is read-only.`)})),X()(this,"onOwnKeys",((e,r,t)=>{var a=this.dispatch;z.callback=a,r(e,r,t),z.callback=null})),this.dispatch=e}},me=require("@babel/runtime-corejs3/core-js-stable/object/keys");var je=e.n(me);const ge=class{constructor(e,r={}){X()(this,"onApply",((e,r,t,a,n,s)=>{if(r(e,r,t,a,n,s),!t._NOTRACK_){var o=G(s),i={},l=f()(o);q()(l).call(l,(e=>{var r=o[e];"function"!=typeof r&&(i[e]=r)}));var c=this.options.interceptor;c&&(i=c(i)),je()(i).length>0&&(this.devTools.send(`${t.name}`,i),$(`Action ${t.name} 执行，更新后的state ${i}`))}})),this.devTools=e,this.options=r}};var ye=e=>{var r=new re,t=new pe;return new I([r,t],"uss").proxyObject(e)},we=(e,r="")=>{var t,s,o,i=(t=(0,n.useReducer)((e=>e+1),0),s=a()(t,2)[1],o=(0,n.useRef)(!1),(0,n.useEffect)((()=>(o.current=!0,()=>{o.current=!1})),[]),()=>{o.current&&s()});return Z(i),(0,n.useMemo)((()=>{var t=new fe(i);return new I([t],r).proxyObject(e)}),[])},qe=(e,r={})=>{if(void 0!==window.__REDUX_DEVTOOLS_EXTENSION__){var t,a=G(e),n=null==(t=e)?void 0:t._NOTRACK_core,s=r.name,o=window.__REDUX_DEVTOOLS_EXTENSION__.connect({name:s||a.key});o.init(a);var i=new ge(o,r);n.use(i)}},Oe=e=>{for(var r=e,t=e;t=G(r);)r=t;return r};const _e=require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols");var Se=e.n(_e);const xe=require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor");var Re=e.n(xe);const ke=require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors");var Te=e.n(ke);const Ne=require("@babel/runtime-corejs3/core-js-stable/object/define-properties");var Ee=e.n(Ne);const Pe=require("@babel/runtime-corejs3/core-js-stable/object/define-property");var Ce=e.n(Pe);const Ae=require("@babel/runtime-corejs3/helpers/asyncToGenerator");var Ke=e.n(Ae);const De=require("@babel/runtime-corejs3/regenerator");var Me=e.n(De);const $e=require("@babel/runtime-corejs3/core-js-stable/instance/reduce");var Be=e.n($e);require("@babel/runtime-corejs3/core-js-stable/promise");var Ge=(e,r,t)=>Be()(r).call(r,((e,r)=>{var a=(e||{})[r];return void 0===a?t:a}),e),Fe=function(){var e=Ke()(Me().mark((function e(r,t){var a,n,s,o,i,l,c,u,v,b,d,h;return Me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.onBefore,n=t.onRequest,s=t.onSuccess,o=t.onError,i=t.onFinally,l=t.onCancel,c=!0,v=!1,a&&(c=!1!==a()),c){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,b=()=>{v=!0,l&&l()},n&&(u=n(b)),void 0===u&&(u=r()),e.next=12,u;case 12:if(d=e.sent,!v){e.next=15;break}return e.abrupt("return");case 15:s&&s(d),i&&i(),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(6),h=e.t0,o&&o(h),i&&i();case 24:case"end":return e.stop()}}),e,null,[[6,19]])})));return function(r,t){return e.apply(this,arguments)}}(),Ue=(e,r)=>r.get(e),Ie=(e,r)=>D(e)?e.apply(void 0,r):[...e,...r],Ve=(e,r)=>{var t=(0,n.useRef)([]);(0,n.useEffect)((()=>{e(...t.current),t.current=r}),r)},Xe=(e,r)=>{if(e===r)return!0;if("object"!=typeof e||null===e||"object"!=typeof r||null===r)return!1;var t=je()(e),a=je()(r);if(t.length!==a.length)return!1;for(var n=0;n<t.length;n++)if(!r.hasOwnProperty(t[n])||e[t[n]]!==r[t[n]])return!1;return!0},He=ye({setData(e,r){for(var t=He,a=e.length,n=0;n<a;n++){var s=e[n];n===a-1?t[s]=r:(void 0===t[s]&&(t[s]={}),t=t[s])}}});qe(He,{name:"data",interceptor:e=>(delete e._MANAGEMENT,e)});var Le=He.setData,Qe=()=>He,We=(e,r)=>Ge(He,e,r),ze=(e,r)=>{var t=we(He);return Ge(t,e,r)};const Je=require("@babel/runtime-corejs3/helpers/objectWithoutProperties");var Ye=e.n(Je);const Ze=require("@babel/runtime-corejs3/core-js-stable/instance/map");var er=e.n(Ze),rr=["isReturn"];function tr(e,r){var t=je()(e);if(Se()){var a=Se()(e);r&&(a=N()(a).call(a,(function(r){return Re()(e,r).enumerable}))),t.push.apply(t,a)}return t}function ar(e){for(var r=1;r<arguments.length;r++){var t,a,n=null!=arguments[r]?arguments[r]:{};r%2?q()(t=tr(Object(n),!0)).call(t,(function(r){X()(e,r,n[r])})):Te()?Ee()(e,Te()(n)):q()(a=tr(Object(n))).call(a,(function(r){Ce()(e,r,Re()(n,r))}))}return e}var nr=()=>{};const sr=class{constructor(e,r,t,a){var n=r.initState,s=void 0===n?{}:n;this.state=ar({loading:!0,params:void 0,data:void 0,error:void 0},s),this.service=e,this.options=r,this.dispatch=a||nr,this.plugins=t||[]}setOptions(e){this.options=e}execPlugins(e,...r){var t,a,n=N()(t=er()(a=this.plugins).call(a,(t=>{var a;return null===(a=t[e])||void 0===a?void 0:a.call(t,...r)}))).call(t,Boolean);return Be()(n).call(n,((e,r)=>ar(ar({},e),r)),{})}updateState(e){this.state=ar(ar({},this.state),e),this.dispatch()}request(...e){var r=this;return Ke()(Me().mark((function t(){var a,n,s,o,i,l,c,u;return Me().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.service,n=r.options,s=n.onBefore,o=n.onSuccess,i=n.onError,l=n.onFinally,c=n.onCancel,u=()=>a(...e),t.next=5,Fe(u,{onBefore:()=>{var t=r.execPlugins("onBefore",e,r),a=t.isReturn,n=Ye()(t,rr);return s&&s(e),a&&r.updateState(ar({},n)),!a},onRequest:t=>{var n={loading:!0,params:e,cancel:t},s=r.execPlugins("onRequest",n,a,r).promise;return r.updateState(n),s},onSuccess:t=>{var a={params:e,loading:!1,cancel:void 0,error:void 0,data:t};r.execPlugins("onSuccess",a,r),o&&o(e,t),r.updateState(a)},onError:t=>{var a={params:e,loading:!1,cancel:void 0,error:t};r.execPlugins("onError",a,r),i&&i(e,t),r.updateState(a)},onFinally:()=>{var t=r.state,a=t.data,n=t.error;r.execPlugins("onFinally",r.state,r),l&&l(e,a,n)},onCancel:()=>{r.execPlugins("onCancel",r),c&&c(),r.updateState({loading:!1})}});case 5:case"end":return t.stop()}}),t)})))()}refetch(e=[]){var r=e;0===e.length&&(r=this.state.params),this.request(...r)}};function or(e,r){var t=je()(e);if(Se()){var a=Se()(e);r&&(a=N()(a).call(a,(function(r){return Re()(e,r).enumerable}))),t.push.apply(t,a)}return t}function ir(e){for(var r=1;r<arguments.length;r++){var t,a,n=null!=arguments[r]?arguments[r]:{};r%2?q()(t=or(Object(n),!0)).call(t,(function(r){X()(e,r,n[r])})):Te()?Ee()(e,Te()(n)):q()(a=or(Object(n))).call(a,(function(r){Ce()(e,r,Re()(n,r))}))}return e}var lr="_MANAGEMENT",cr="snapshot",ur=["stale","state"],vr=(e,r)=>{Le._NOTRACK_=!0,Le([lr,...e,...ur],r),Le._NOTRACK_=!1},br=(e,r)=>{Le._NOTRACK_=!0,Le([lr,...e,cr],r),Le._NOTRACK_=!1},dr=e=>We([lr,...e,"stale"]),hr=e=>We([lr,...e,cr]),pr=e=>{var r;0!==e.length&&-1===x()(r=e).call(r,void 0)&&vr(e,!0)};class fr{constructor(e){X()(this,"onBefore",((e,r)=>{this.unSub();var t=Ie(se()(this),e),a=dr(t);if(null==a||!a.state){var n=hr(t);return null!=n&&n.data?(this.unSub=he(dr(t),(()=>{console.log("重新请求"),r.refetch()})),{isReturn:!0,data:n.data,params:n.params,error:void 0}):void 0}})),X()(this,"onRequest",(e=>{var r=e.params,t=Ie(se()(this),r),a=hr(t)||{};br(t,ir(ir({},a),e))})),X()(this,"onSuccess",(e=>{var r=e.params,t=e.data,a=Ie(se()(this),r),n=hr(a)||{};Le(a,t),br(a,ir(ir({},n),e)),vr(a,!1)})),X()(this,"onError",(e=>{var r=e.params,t=Ie(se()(this),r),a=hr(t)||{};br(t,ir(ir({},a),e)),vr(t,!1)})),X()(this,"onFinally",((e,r)=>{var t=e.params,a=Ie(se()(this),t);this.unSub=he(dr(a),((e,t,a)=>{console.log("重新请求"),r.refetch()}))})),this.keys=e,this.unSub=()=>{}}}class mr{constructor(e,r){X()(this,"onBefore",(e=>{var r=this.cachePromise,t=Ie(se()(this),e).join();if(Ue(t,r))return{isReturn:!0}})),X()(this,"onRequest",((e,r)=>{var t=e.params,a=this.cachePromise,n=Ie(se()(this),t).join(),s=Ue(n,a);return s||((e,r,t)=>{t.set(e,r),r.then((r=>(t.delete(e),r))).catch((()=>{t.delete(e)}))})(n,s=r(...t),a),{promise:s}})),this.keys=e,this.cachePromise=r}}function jr(e,r){var t=je()(e);if(Se()){var a=Se()(e);r&&(a=N()(a).call(a,(function(r){return Re()(e,r).enumerable}))),t.push.apply(t,a)}return t}function gr(e){for(var r=1;r<arguments.length;r++){var t,a,n=null!=arguments[r]?arguments[r]:{};r%2?q()(t=jr(Object(n),!0)).call(t,(function(r){X()(e,r,n[r])})):Te()?Ee()(e,Te()(n)):q()(a=jr(Object(n))).call(a,(function(r){Ce()(e,r,Re()(n,r))}))}return e}var yr=new(L()),wr=(e,r,t)=>{var s=t||{},o=s.manual,i=void 0!==o&&o,l=s.params,c=void 0===l?[]:l,u=s.placeholderData,v=(0,n.useState)([]),b=a()(v,2),d=b[0],h=b[1],p=(0,n.useMemo)((()=>{var a={loading:!i,data:u,params:c},n=gr(gr({},t),{},{initState:a}),s=new fr(e),o=new mr(e,yr);return new sr(r,n,[s,o])}),[]);p.setOptions(t),Ve(((e,r)=>{var t;i||!c||ie()(t=c).call(t,void 0)||Xe(r,c)||p.refetch(c)}),[i,c]),Ve((e=>{i&&d&&!ie()(d).call(d,void 0)&&!Xe(e,d)&&p.refetch(d)}),[d]);var f=((e,r,t,a)=>{var n,s=Ie(e,a);return r&&(s=Ie(e,t)),-1===x()(n=s).call(n,void 0)?s:[]})(e,i,d,c),m=((e,r)=>{if(0===e.length)return ze([],r);var t=[lr,...e,cr];return ze(t,r)})(f,{});return(0,n.useMemo)((()=>{var e=(...e)=>{};return t.manual&&(e=(...e)=>{h(e)}),{loading:m.loading,data:m.data||p.state.data,error:m.error,cancel:m.cancel,refetch:e}}),[m])},qr=(e,r)=>{var t=(0,n.useReducer)((e=>e+1),0),s=a()(t,2)[1],o=(0,n.useRef)((()=>{})),i=(0,n.useMemo)((()=>new sr(e,r,[],s)),[]),l=(0,n.useCallback)(((...e)=>{i.refetch(e)}),[]);return o.current=i.state.cancel,{loading:i.state.loading,data:i.state.data,error:i.state.error,cancel:o,mutate:l}};function Or(e,r){var t=je()(e);if(Se()){var a=Se()(e);r&&(a=N()(a).call(a,(function(r){return Re()(e,r).enumerable}))),t.push.apply(t,a)}return t}function _r(e){for(var r=1;r<arguments.length;r++){var t,a,n=null!=arguments[r]?arguments[r]:{};r%2?q()(t=Or(Object(n),!0)).call(t,(function(r){X()(e,r,n[r])})):Te()?Ee()(e,Te()(n)):q()(a=Or(Object(n))).call(a,(function(r){Ce()(e,r,Re()(n,r))}))}return e}var Sr=(e,r)=>{Le(e,r);var t=hr(e);br(e,_r(_r({},t),{},{data:r})),vr(e,!1)};return r})()));